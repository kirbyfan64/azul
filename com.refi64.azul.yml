app-id: com.refi64.azul.debug
runtime: org.gnome.Platform
runtime-version: 3.28
sdk: org.gnome.Sdk
command: python3.6 /app/bin/azul.py
finish-args:
  - --socket=x11
  - --share=network
modules:
  - name: python
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.6.4/Python-3.6.4.tar.xz
        sha256: 159b932bf56aeaa76fd66e7420522d8c8853d486b8567c459b84fe2ed13bcaba
    config-opts:
      - --enable-shared
      - --enable-optimizations
      - --enable-ipv6
      - --with-threads
      - --with-lto
      - --without-ensurepip
      - --with-system-ffi
      - --with-system-libmpdec
      - --with-system-expat
    build-options:
      prefix: /app
      # no-debuginfo: true
    post-install:
      - chmod 755 /app/lib/libpython*.so*
    cleanup:
      - /bin/2to3*
      - /bin/easy_install*
      - /bin/idle
      - /bin/python*-config
      - /bin/pyvenv*
      - /bin/pydoc*
      - /include
      - /share
      - /lib/pkgconfig
      - /lib/python*/config-*

      # Test scripts
      - /lib/python*/test
      - /lib/python*/distutils/tests
      - /lib/python*/ctypes/tests
      - /lib/python*/sqlite3/tests
      - /lib/python*/lib2to3/tests
      - /lib/python*/tkinter/tests
      - /lib/python*/unittest/tests
      - /lib/python*/lib-dynload/_*_test.*.so
      - /lib/python*/lib-dynload/_test*.*.so

      # Unused modules
      - /lib/python*/idlelib
      - /lib/python*/tkinter
      - /lib/python*/turtle*

      - '*.pyc'
      - __pycache__
      - '*.exe'
  - name: zulip
    buildsystem: simple
    build-commands:
      - python3 -m pip install zulip
  - name: azul
    buildsystem: simple
    build-commands:
      - make install-settings
      - cp azul.py /app/bin
    sources:
      - type: file
        path: .
        dest-filename: azul
