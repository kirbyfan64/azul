sudo: required
services:
  - docker

language: generic

before_script:
  - mkdir -p ~/docker
  - |
      if [[ -f ~/docker/flatpak-image ]]; then
        (set -x; docker load -i ~/docker/flatpak-image)
      else
        (set -x;
         docker pull flatpak/flatpak-builder:gnome-3-28;
         docker save -o ~/docker/flatpak-image flatpak/flatpak-builder:gnome-3-28)
      fi

script:
  - env | grep 'TRAVIS\|encrypted' > travis.env
  - >
      docker run --privileged --env-file travis.env -it --rm
      --mount type=bind,source=$PWD,target=/workspace
      flatpak/flatpak-builder:gnome-3-28 /workspace/travis/run.sh

cache:
  directories:
    - ~/docker
  timeout: 1000
